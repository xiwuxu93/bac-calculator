# BAC Calculator 数据与规则规划（草案）

> 目的：整理后续实现 BAC 计算器所需的公式、参数、酒种分类、法定上限与单位换算结构。所有具体数值在开发阶段应再与权威来源核对更新。

---

## 1. 采用的 BAC 估算公式（Widmark 思路）

在线 BAC 计算器通常基于 Widmark 公式或其变体：

- **基本形式（简化版）**  
  - 估算 BAC（质量分数，单位约为 g/dL 或 %）  
  - 常见表达之一：  
    - `BAC ≈ (A / (r × W)) – β × t`
    - 其中：  
      - `A`：摄入的纯酒精总量（克）  
      - `r`：酒精分布容积系数（男性约 0.68–0.70，女性约 0.55–0.60，不同来源略有差异）  
      - `W`：体重（千克或磅，需要统一单位后使用）  
      - `β`：酒精代谢速率（每小时 BAC 降低量，常见假设约 0.010–0.020 %BAC/h）  
      - `t`：从第一杯酒开始到当前的时间（小时）

实现时要点：

- 将所有体积单位统一为 mL，再乘以 ABV 与酒精密度，得到酒精质量 `A`（克）。  
- 根据用户性别选择 `r` 的默认值，可在将来提供“高级选项”允许用户选择不同体型/系数。  
- `β` 可采用单一固定值（如 0.015 %BAC/h）或给出范围（例如结果展示成区间）。

> **TODO（开发阶段）**：  
> - 选定具体的 `r` 与 `β` 数值，并在页面上说明来源（例如科学文献或公共卫生机构资料）。  
> - 在技术说明中加入公式推导与限制。

参考方向（待验证的示例来源）：

- 教科书 / 综述文章中 Widmark 公式的介绍  
- 公共机构关于酒精代谢的科普（NIH / CDC / WHO 等）  

---

## 2. 公式参数与单位

### 2.1 酒精总量 A 的计算

统一思路：对每一种饮品行，计算其贡献的纯酒精质量，然后求和。

- 用户输入字段（规划）：  
  - 饮品类型：Beer / Wine / Spirits / Custom  
  - 数量：N（杯/瓶/shot 的个数）  
  - 每份体积：V（mL）——通过下拉选项或自定义输入  
  - 酒精度：ABV（%）  
- 计算流程：  
  - 单份体积 (mL) → 体积 (L)：`V_L = V_mL / 1000`  
  - 单份纯酒精体积 (L)：`V_alc = V_L × (ABV / 100)`  
  - 纯酒精质量（克）：`m = V_alc × ρ_alc × N`  
    - ρ_alc（乙醇密度）可按 0.789 g/mL（即 789 g/L）近似

> **计划**：在实现时把所有常用选择（体积、ABV、类别）放在一个常量配置文件中，便于维护。

### 2.2 分布容积系数 r

常见假设（仅作结构展示，具体数值发布前需再次核实）：

- 男性：`r_m ≈ 0.68–0.70`  
- 女性：`r_f ≈ 0.55–0.60`

实现建议：

- 使用一个默认常量，例如：  
  - 男性 `0.68`，女性 `0.55`（或选择更权威的一组）。  
- 在技术说明中注明：不同研究存在差异，估算仅供参考。

### 2.3 代谢速率 β

常见的经验值区间：

- `β ≈ 0.010–0.020 %BAC / hour`  
- 许多在线工具采用中间值，例如 `0.015 %BAC/h`。

实现建议：

- 初版采用固定值（如 `0.015`），输出单一估算值。  
- 在后续版本中，考虑输出“范围”，例如基于 `0.010` 与 `0.020` 同时计算，显示“X–Y 小时”。

---

## 3. 酒种类别与默认 ABV

> 以下为规划结构与典型范围，具体数值需要在开发阶段参考权威来源或市场主流产品后再定。

### 3.1 类别规划

- Beer（啤酒）
- Wine（葡萄酒）  
- Spirits（烈酒，例如 whisky, vodka, rum 等）
- Other / Custom（预调酒、鸡尾酒等，用户手动输入 ABV）

### 3.2 默认 ABV 范围示例（仅为规划）

- Beer：  
  - Light beer：~4.0–4.5%  
  - Regular beer：~5%  
  - Strong beer：~6–7%  
- Wine：  
  - Light white wine：~11–12%  
  - Regular wine：~12–13.5%  
  - Fortified wine：~15–20%  
- Spirits：  
  - 标准蒸馏酒：~40%（80 proof）  
  - 高度数烈酒：>40%（在工具中作为高级选项提供）

> **实现策略**：  
> - 下拉选项中提供常见组合（例如 5%、12%、40%），并支持自定义。  
> - 每一类中的默认值通过常量对象配置，并可在文档中说明“这是典型值，品牌会有差异”。

---

## 4. 常用容量选项规划

> 目标：覆盖美制/公制常见杯型和包装，方便快速选择。

### 4.1 啤酒（Beer）

- 250 mL bottle / glass  
- 330 mL bottle / can（12 oz）  
- 440–500 mL（16 oz pint）  
- 600 mL（20 oz，大杯）  
- 1 L（大瓶）

### 4.2 葡萄酒（Wine）

- 60 mL（2 oz，小杯/品鉴杯）  
- 150 mL（5 oz，常见红酒杯）  
- 250 mL（8 oz，大杯）  
- 375 mL（半瓶）  
- 750 mL（标准瓶）

### 4.3 烈酒（Spirits）

- 30 mL（1 oz，单 shot）  
- 44 mL（1.5 oz，常见 shot）  
- 60 mL（2 oz，double）  
- 750 mL（标准瓶）

> 所有容量都将转换为 mL，在计算时统一处理。

---

## 5. 各国家/地区法定 BAC 上限（结构规划）

> 这里只规划结构与大致方向，具体数值需在开发时统一查证并注明来源。  
> 实现时可用一个 `LEGAL_LIMITS` 常量，按国家/地区编码存放。

示例字段结构：

```ts
type LegalLimit = {
  general: number | null;        // 一般驾驶员上限（%BAC），未知则为 null
  novice?: number | null;        // 新手司机上限（如有）
  professional?: number | null;  // 职业司机上限（如有）
  notes?: string;                // 说明（零容忍、不同州差异等）
  sourceUrl?: string;            // 官方来源链接
};
```

### 5.1 需要重点覆盖的国家/地区

- 美国（US）  
  - 多数州一般上限约为 0.08%  
  - 某些州对商用/职业司机及未成年司机有更严格标准  
- 英国（UK）  
  - 英格兰、威尔士与苏格兰存在差异（苏格兰更严格）  
- 澳大利亚（AU）  
  - 多数州一般上限约为 0.05%，对新手/职业司机有更低上限  
- 加拿大（CA）  
  - 联邦及省级规定组合，除了刑事上限外，各省可能设置“警示区间”  
- 新西兰（NZ）  
  - 一般上限约为 0.05%，并对 20 岁以下驾驶者实行更严格或零容忍政策  
- 摩洛哥（MA / Maroc）  
  - 需要查证当前是否接近“低限度”或“接近零容忍”的政策  
- 阿尔及利亚（DZ）  
  - 普遍报道倾向于极低或零容忍政策（需查证）

> **实现注意**：  
> - 不在代码中硬编码“绝对正确”的值，而是在常量中清晰标注来源与更新时间。  
> - 在页面中强调：法律限制会变化，用户必须以当地官方信息为准。

---

## 6. 风险等级区间规划

> 用于在结果区域显示 “低/中/高风险” 标签和简短解释。

### 6.1 预设区间（可根据研究与 UX 调整）

- 低风险区（仍不建议驾驶）：  
  - 约 `0.000–0.029%`：多数人看起来接近正常，但精细任务可能已受影响  
- 中等风险区（明显受损，接近或超过多数国家酒驾上限）：  
  - 约 `0.030–0.079%`：判断力、集中力与反应时间明显下降  
- 高风险区（法律与安全风险极高）：  
  - `≥ 0.080%`：在许多地区已达到或超过酒驾标准，发生事故和严重后果的风险显著增加

> 实际区间可以更细，例如结合表格描述 0.10–0.15、>0.20 等，但初版可以先聚焦于“是否接近/超过法律上限”。

### 6.2 每个区间的文案方向

- 低风险：强调“即使低于法律上限，也可能不适合驾驶”。  
- 中风险：强调“强烈不建议驾驶，许多地区在此范围内已属违法”。  
- 高风险：强调“极高风险、可能违法和危及生命，应立即停止饮酒并寻求安全方式回家”。

---

## 7. Time‑to‑zero 算法规划

> 目标：根据当前估算 BAC 或总酒精量，估算回落到 0.00% 或法律上限所需时间。

### 7.1 输入选项

- 模式 A：基于当前估算 BAC（来自主计算器结果）  
- 模式 B：基于饮酒信息重新估算当前 BAC（备用）

### 7.2 计算思路

- 假设代谢速率为固定值 `β`（例如 0.015 %BAC/h）：  
  - 到 0.00% 的时间：`t_zero = currentBAC / β`  
  - 到法定上限 L 的时间：`t_limit = max(0, (currentBAC - L) / β)`  
- 如采用范围 `β_min` 与 `β_max`：  
  - 输出区间型结果，例如：  
    - `t_zero_low = currentBAC / β_max`  
    - `t_zero_high = currentBAC / β_min`

实现提示：

- 结果展示建议采用“范围 + 文字说明”，例如：  
  - “Based on typical elimination rates, it may take approximately 5–7 hours for your BAC to return to 0.00%. Everyone is different, so this is only an estimate.”  
- 在页面醒目位置强调：  
  - “即使估算显示已经到 0.00%，也不能保证你已完全清醒或适合驾驶。”

---

## 8. 权威来源清单（初稿，待开发阶段补充链接）

> 用于后续在页面底部列出参考资料，并在常量中标记出处。

- 美国国家酒精滥用与酒精中毒研究所（NIAAA / NIH）  
- 美国疾病控制与预防中心（CDC）关于酒精与驾驶的科普页面  
- 世界卫生组织（WHO）关于道路安全与酒精的报告  
- 各国交通管理部门官方网站（例如美国各州 DMV、英国 gov.uk 等）  

开发阶段应：

- 为每个国家/地区的法定上限记录具体的官方页面 URL；  
- 在页面上注明“数据最后更新日期”；  
- 在免责声明中再次强调可能存在滞后。

---

本文件仅为规划草案，不直接参与前端呈现。  
在开发阶段，应根据本结构创建对应的 TypeScript 常量与测试用例，并在页面文案中解释所有关键假设与限制。 

